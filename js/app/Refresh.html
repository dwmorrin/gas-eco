<script>
/**
 * main server callback function
 * @see js/Init
 * this is attached to google.script.run.withSuccessHandler
 */
/* global
app
displayForm
displayOpenForms
*/
app.refresh = function(response) {
  switch (response.target) {
    case 'archive':
      if (response.unlock) {
        app.elements.archiveButton.removeAttribute('disabled');
      } else { // remove spinner from query button
        app.pages.archive.elements.queryButton.innerHTML = 'Update View';
      }
      app.cache.archive = JSON.parse(response.formList);
      app.pages.archive.query();
      break;
    case 'codabar':
      app.cache.students = JSON.parse(response.students);
      app.modal.hide();
      app.omnibox.parse();
      break;
    case 'items':
      app.cache.items = JSON.parse(response.items);
      break;
    case 'openForms':
      if (response.unlock) {
        app.elements.openFormsButton.removeAttribute('disabled');
      }
      app.changes.saved = true;
      app.cache.openForms = JSON.parse(response.formList);
      app.spinner.off();
      app.showPage(app.pages.openForms);
      displayOpenForms(app.cache.openForms);
      app.cache.currentFormstack = 'openForms';
      break;
    case 'signature':
      app.cache.students = JSON.parse(response.students);
      app.omnibox.parse();
      break;
    case 'startSignature':
      app.modal.signatureReady();
      break;
    case 'students': // doCommand 'signatureRecheck' refreshes here
      app.cache.students = JSON.parse(response.students);
      if (response.unlock) {
        app.elements.newFormButton.removeAttribute('disabled');
      } else {
        app.omnibox.parse();
      }
      break;
    case 'updateForm':
      app.changes.saved = true;
      app.pages.form.elements.undoButton.setAttribute('disabled', true);
      app.pages.form.elements.updateButtonHint.textContent = '';
      app.pages.form.elements.updateFormButton.setAttribute('disabled', true);
      displayForm(JSON.parse(response.form));
      break;
    case 'user':
      app.elements.usernameDisplay.textContent = response.user;
      break;
  }
  
};
</script>
