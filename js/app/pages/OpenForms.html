<script>
/* global app displayOpenForms */
app.pages.openForms = {
  elements: {
    container:          document.querySelector('div.openFormsContainer'),
    equipmentTableBody: document.querySelector('tbody.equipmentOut'),
    formsTableBody:     document.querySelector('tbody.open'),
    formsTableHead:     document.querySelector('thead.open'),
  },
  handleClickTable: function(click) {
    let findForm = function(form) {
      return form.id == click.target.parentNode.getAttribute('data-id');
    };
    const index = app.cache.openForms.findIndex(findForm);
    if (index < 0) {
      return;
    }
    app.cache.currentIndex = index;
    app.doCommand('displayForm', app.cache.openForms[index], false);
  },
  handleClickTableHead: function(click) {
    app.doCommand('sortOpenForms', click.target.dataset.sort);
  },
  show: function() {
    app.pages.openForms.elements.container.classList.remove("hidden");
    if (isNaN(app.pages.openForms.refreshId)) {
      app.pages.openForms.setInterval();
    }
  },
  hide: function() {
    app.pages.openForms.elements.container.classList.add("hidden");
    if (! isNaN(app.pages.openForms.refreshId)) {
      window.clearInterval(app.pages.openForms.refreshId);
    }
    app.pages.openForms.refreshId = NaN;
  },
  refreshId: NaN,
  setInterval: function() {
    // this client-side only interval is just for getting the forms to change color
    app.pages.openForms.refreshId = window.setInterval(displayOpenForms, 60000, app.cache.openForms);
  },
  sortBy: 'startTime',
};
</script>
